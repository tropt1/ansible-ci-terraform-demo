# üìò –û–ø–∏—Å–∞–Ω–∏–µ

–í –¥–∞–Ω–Ω–æ–π –ø–∞–ø–∫–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ñ–∞–π–ª—ã –¥–ª—è terraform, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –µ–µ —Ä–∞–±–æ—Ç—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –æ–±–ª–∞–∫–µ Yandex Cloud.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
yc-terraform-vm/
‚îú‚îÄ‚îÄ provider.tf          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Terraform-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ Yandex.Cloud
‚îú‚îÄ‚îÄ variables.tf         # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ö–æ–¥–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ main.tf              # –†–µ—Å—É—Ä—Å—ã VPC, –ø–æ–¥—Å–µ—Ç—å, VM
‚îú‚îÄ‚îÄ outputs.tf           # –í—ã–≤–æ–¥ IP-–∞–¥—Ä–µ—Å–æ–≤ –∏–Ω—Å—Ç–∞–Ω—Å–∞
‚îú‚îÄ‚îÄ secrets.tfvars       # –ó–Ω–∞—á–µ–Ω–∏—è –¥–ª—è yc_token, cloud_id, folder_id, zone (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
‚îî‚îÄ‚îÄ .gitignore           # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç secrets.tfvars –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Ñ–∞–π–ª—ã
```

## ‚öôÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Terraform
–°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Terraform –≤–µ—Ä—Å–∏–∏ ‚â• 1.1 –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–µ—Å—Ç—Ä–∞

2. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∞–π–ª –∫–ª—é—á–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞

- –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç —á–µ—Ä–µ–∑ `yc iam service-account create`
- –ù–∞–∑–Ω–∞—á—å—Ç–µ –µ–º—É —Ä–æ–ª—å `roles/vpc.admin` –Ω–∞ –Ω—É–∂–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ
- –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ JSON-–∫–ª—é—á:

```lua
yc iam service-account create-key \
  --service-account-id <ID> \
  --output key.json
```

3. –°–æ–∑–¥–∞–π—Ç–µ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ secrets.tfvars
```bash
nano secrets.tfvars
```

```hcl
yc_token  = "<path/to/key.json>"  
cloud_id  = "<–≤–∞—à-cloud-id>"  
folder_id = "<–≤–∞—à-folder-id>"  
zone      = "ru-central1-a"
```
4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ Terraform

```bash
terraform init                              
terraform plan -var-file=secrets.tfvars     
terraform apply -var-file=secrets.tfvars  
```

–ï—Å–ª–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, Terraform —Å–æ–∑–¥–∞—Å—Ç —Å–µ—Ç—å, –ø–æ–¥—Å–µ—Ç—å –∏ VM

## üöß –ù–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º terraform apply –ø–æ—è–≤–∏–ª—Å—è –æ—Ç–≤–µ—Ç –æ—Ç API Yandex.Cloud:

```vbnet
rpc error: code = PermissionDenied desc = Operation is not permitted in the folder
```
–≠—Ç–æ –æ–∑–Ω–∞—á–∞–ª–æ, —á—Ç–æ –∫–ª—é—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–µ –∏–º–µ–ª —Ä–æ–ª–∏ `vpc.admin` –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º `folder_id`. –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –ø—Ä–∏–≤—è–∑–∫—É —Ä–æ–ª–∏ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–ª–∞—Å—å, –∏ –∑–∞–ø—É—Å–∫ —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–µ —Å–æ—Å—Ç–æ—è–ª—Å—è.
